---
title: "STAT 380 Fianl Project"
output: html_notebook
author: Nicholas Anderson
---

Processes needed:

- Visualizations

- Linear Regression

- Cross-Validation

- Clustering

- Ridge/Lasso regression

- Effects on price by rooms

- Effects on price by renovation

- Tree model


### Loading and skim of the data
```{r}
library(tidyverse)
library(sf)
library(mapview)
library(dplyr)
library(glmnet)
library(leaps)
library(caret)
library(mdsr)
library(mvtnorm)
library(factoextra)
library(NbClust)
library(cluster)

set.seed(1)
data <- read.csv("house_data.csv", header = TRUE, sep = ",")
ranData <- sample_n(data, 500) %>% select(-c(id, date))
ranData
skim(ranData)
```

### mapview of houses
```{r}

#mapview(ranData, xcol = "long", ycol = "lat", crs = 4269, grid = FALSE)
```

### linear regression price to rooms
```{r}
lr_model_rooms <- lm(price ~ bedrooms + bathrooms, data = ranData)
summary(lr_model_rooms)
```

### linnear regression of price to size
```{r}
lr_model_size <- lm(price ~ sqft_living + sqft_lot, data = ranData)
summary(lr_model_size)
```
### linnear regression of price to year built
```{r}
lm_price_age <- lm(price ~ yr_built, data = ranData)
summary(lm_price_age)
```
### Cp, BIC, and Adjusted R^2
```{r}
regressionDf <- ranData

regfit.full = regsubsets(price ~ ., data = regressionDf,  nvmax = 19, method="forward")
summary(regfit.full)

reg.summary <- summary(regfit.full)

par(mfrow=c(2,2))

plot(reg.summary$cp ,xlab="Number of Variables ",ylab="Cp", type='l')
min_cp <- which.min(reg.summary$cp )
points(min_cp, reg.summary$cp[min_cp],col="blue",cex=2,pch=20)

plot(reg.summary$bic ,xlab="Number of Variables ",ylab="BIC",type='l')
min_bic <- which.min(reg.summary$bic)
points(min_bic,reg.summary$bic[min_bic],col="blue",cex=2,pch=20)


plot(reg.summary$adjr2 ,xlab="Number of Variables ", ylab="Adjusted RSq",type="l")
max_adjr2 <- which.max(reg.summary$adjr2)
points(max_adjr2,reg.summary$adjr2[max_adjr2], col="blue",cex=2,pch=20)
```

### Average prices and grade by year
```{r}
avgPriceByYr <- ranData %>% select(price, yr_built, grade) %>%
  group_by(yr_built) %>%
  summarise(avgPrice = mean(price), avgGrade = mean(grade))

avgPriceByYr


```

### Principal component analysis
```{r}

```

### Hierarchical Clustering
```{r}
eu_dist <- get_dist(scale(ranData), method='euclidean')
hc_single <- hclust(eu_dist, method='complete')
plot(hc_single)

func <- function(data, k) {
  kmeans(data, k, nstart = 10)$tot.withinss
}

kVals <- 1:12

funcVals <- map_dbl(kVals, func, data = scale(ranData))

plot(kVals, funcVals, type = "b")

fviz_nbclust(scale(ranData), kmeans, method = "silhouette")

distance <- get_dist(eu_dist, method = "euclidean")

kMean <- scale(ranData) %>% kmeans(2)
cluster <- kMean$cluster
sil <- silhouette(x = cluster, dist = distance)

fviz_silhouette(sil)

NbClust(scale(ranData),  distance = "euclidean", method = "kmeans", index = "hartigan")
```

Two clusters is the optimal number. 









Source: <https://www.kaggle.com/datasets/abdallahwagih/house-price>
